<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>miRNA ASD Database</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
    <style>
        body {
            font-family: sans-serif;
        }
        .container {
            width: 80%;
            margin: 0 auto;
        }
        td.details-control {
            background: url('https://datatables.net/examples/resources/details_open.png') no-repeat center center;
            cursor: pointer;
        }
        tr.details td.details-control {
            background: url('https://datatables.net/examples/resources/details_close.png') no-repeat center center;
        }
        thead input {
            width: 100%;
            padding: 3px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="my-4">miRNA ASD Database</h1>

        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="expression-tab" data-bs-toggle="tab" data-bs-target="#expression" type="button" role="tab" aria-controls="expression" aria-selected="true">Expression</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="genetic-tab" data-bs-toggle="tab" data-bs-target="#genetic" type="button" role="tab" aria-controls="genetic" aria-selected="false">Genetic</button>
            </li>
        </ul>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="expression" role="tabpanel" aria-labelledby="expression-tab">
                <h2 class="my-3">miRNA Expression Studies</h2>
                <table id="expression-table" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th></th>
                            <th>miRNA Hairpin</th>
                            <th>miRNA Mature</th>
                            <th>Reported</th>
                            <th>Alteration</th>
                            <th>Tissue</th>
                            <th>Number of studies down or upregulated</th>
                            <th>Total studies</th>
                            <th>Observations</th>
                        </tr>
                        <tr class="filters"> 
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="tab-pane fade" id="genetic" role="tabpanel" aria-labelledby="genetic-tab">
                <h2 class="my-3">miRNA Other Studies</h2>
                <table id="other-table" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th></th>
                            <th>miRNA Hairpin</th>
                            <th>miRNA Mature</th>
                            <th>Reported</th>
                            <th>Alteration</th>
                        </tr>
                        <tr class="filters"> 
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables JS -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
    <script>
    function format ( details ) {
        // `details` is the array of study details objects
        if (!details || details.length === 0) {
            return '<p>No study details available.</p>';
        }

        let table = '<table class="table"><thead><tr><th>Study</th><th>Title</th><th>DOI</th><th>Study Type</th><th>Tissue type</th><th>Tissue - subtype</th><th>number ASD samples</th><th>number Control samples</th><th>others</th></tr></thead><tbody>';
        details.forEach(function(d) {
            table += '<tr>' +
                '<td>' + (d.Study || '') + '</td>' +
                '<td>' + (d.Title || '') + '</td>' +
                '<td><a href="' + (d.DOI || '') + '" target="_blank">' + (d.DOI || '') + '</a></td>' +
                '<td>' + (d["Study Type"] || '') + '</td>' +
                '<td>' + (d["Tissue type"] || '') + '</td>' +
                '<td>' + (d["Tissue - subtype"] || '') + '</td>' +
                '<td>' + (d["number ASD samples"] || '') + '</td>' +
                '<td>' + (d["number Control samples"] || '') + '</td>' +
                '<td>' + (d.others || '') + '</td>' +
            '</tr>';
        });
        table += '</tbody></table>';
        return table;
    }

    $(document).ready(function() {
        function initializeDataTable(tableId, ajaxUrl, columnsConfig) {
            var table = $(tableId).DataTable({
                "ajax": {
                    "url": ajaxUrl,
                    "dataSrc": ""
                },
                "columns": columnsConfig,
                "orderCellsTop": true,
                "fixedHeader": true,
                "initComplete": function () {
                    var api = this.api();
                    api.columns().every(function (colIdx) {
                        var column = this;
                        var header = $(api.column(colIdx).header());
                        // Add search input only to columns that are not the details control
                        if (!header.hasClass('details-control')) {
                            var input = $('<input type="text" placeholder="Search ' + header.text() + '" />')
                                .appendTo($('tr.filters th', api.table().header()).eq(colIdx))
                                .on('keyup change clear', function () {
                                    if (column.search() !== this.value) {
                                        column.search(this.value).draw();
                                    }
                                });
                        }
                    });
                }
            });
            return table;
        }

        // Expression Studies Table
        var expressionTable = initializeDataTable(
            '#expression-table',
            'expression_studies.json',
            [
                {
                    "className":      'details-control',
                    "orderable":      false,
                    "data":           null,
                    "defaultContent": ''
                },
                { "data": "miRNA_hairpin", "render": function(data, type, row) { return data; } },
                { "data": "miRNA_mature", "render": function(data, type, row) { return data; } },
                { "data": "Reported" },
                { "data": "Alteration" },
                { "data": "Tissue" },
                { "data": "Number of studies down or upregulated" },
                { "data": "Total studies" },
                { "data": "Observations" }
            ]
        );

        // Other Studies Table
        var otherTable = initializeDataTable(
            '#other-table',
            'other_studies.json',
            [
                {
                    "className":      'details-control',
                    "orderable":      false,
                    "data":           null,
                    "defaultContent": ''
                },
                { "data": "miRNA_hairpin", "render": function(data, type, row) { return data; } },
                { "data": "miRNA_mature", "render": function(data, type, row) { return data; } },
                { "data": "Reported" },
                { "data": "Alteration" }
            ]
        );

        // Add event listener for opening and closing details
        $('tbody').on('click', 'td.details-control', function () {
            var tr = $(this).closest('tr');
            var table = $(this).closest('table').DataTable();
            var row = table.row( tr );

            if ( row.child.isShown() ) {
                // This row is already open - close it
                row.child.hide();
                tr.removeClass('details');
            }
            else {
                // Open this row
                row.child( format(row.data().StudyDetails) ).show();
                tr.addClass('details');
            }
        } );
    });
    </script>
</body>
</html>